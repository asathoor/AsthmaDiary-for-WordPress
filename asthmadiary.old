<?php
/*
Plugin Name: Asthma Diary
Plugin URI: http://multimusen.dk/
Description: If you suffer from asthma monitoring the symptoms on a regular basis is a good idea. This plugin will help you to monitor your peakflow and other important asthmatic symptoms in the Dashboard. The results will be stored in a database. You can add the results on any page, post or template by this shortcode [asthmadiary]
Version: 0.2
Author: Per Thykjaer Jensen
Author URI: http://multimusen.dk
License: &copy; Per Thykjaer Jensen - free to use by any asthma patient. For commercial use please contact the author.
*/

// INSTALLING THE DATABASE
// inspired by: http://jacobschatz.com/?p=23 - dog er versionstjek forsoegt droppet

check_asthmablog_database(); // tjekker om databasen findes, hvis ikke skabes den.

function check_asthmablog_database()
{
    global $wpdb; // The WP database controller class
	// $rq_db_version = 1.0; 
	// praktisk hvis der versioneres efter db
	$table_name = "asthmablog";
	if($wpdb->get_var("SHOW TABLES LIKE '$table_name'") != $table_name)
	{
		$sql = "CREATE TABLE " . $table_name . " (

		ab_id INT(11) NOT NULL AUTO_INCREMENT,
		ab_note TEXT,
		ab_name TEXT,
		ab_peakflow INT(4),
		ab_cough INT(1),
		ab_wheeze INT(1),
		ab_sleep INT(1),
		ab_activity INT(1),
		PRIMARY KEY  id (ab_id)
		);";
 
		require_once(ABSPATH . 'wp-admin/includes/upgrade.php');
		dbDelta($sql);
 
		

		$insert = "INSERT INTO " . $table_name .
		" (ab_note, ab_name, ab_peakflow, ab_cough, ab_wheeze, ab_sleep, ab_activity) " .
            "VALUES ('test', 'test', '0', '0', '0', '0', '0')";
 
		$results = $wpdb->query( $insert );
		// add_option("rq_db_version", $rq_db_version);
		
	}
        //for updates
        //$installed_ver = get_option( "cl_db_version" );
}

// SHORTCODE FOR PAGES, TEMPLATES AND POSTS
// testfunction
function helloPETJ(){
	echo "Hello world, testing... testing...";
}

// add shortcode [asthmadiary] for use on pages or in templates
add_shortcode('asthmadiary', 'helloPETJ');

// DASHBOARD
// Function that output's the contents of the dashboard widget
function dashboard_widget_function() {
	// echo "...form for input to the Asthma Diary...";
	require('form.inc');
}

// Function that being used in the action hook
function add_dashboard_widgets() {
	wp_add_dashboard_widget('dashboard_widget', 'Asthma Diary', 'dashboard_widget_function');
}

// Register the new dashboard widget into the 'wp_dashboard_setup' action
add_action('wp_dashboard_setup', 'add_dashboard_widgets' );
?>
